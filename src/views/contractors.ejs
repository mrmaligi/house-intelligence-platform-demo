<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contractors - House Intelligence</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }
    .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px 20px;
      text-align: center;
    }
    header h1 { font-size: 1.8em; }
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #667eea;
      text-decoration: none;
    }
    .back-link:hover { text-decoration: underline; }
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    .card h3 {
      color: #666;
      font-size: 0.9em;
      margin-bottom: 10px;
      text-transform: uppercase;
    }
    .card .value {
      font-size: 2.2em;
      font-weight: bold;
      color: #667eea;
    }
    .section {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .section h2 {
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #667eea;
    }
    .project-section {
      margin-bottom: 40px;
    }
    .project-title {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .project-title h3 {
      margin: 0;
      font-size: 1.2em;
    }
    .project-title .budget {
      opacity: 0.9;
      font-size: 0.9em;
      margin-top: 5px;
    }
    .contractor-card {
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.2s;
    }
    .contractor-card:hover {
      border-color: #667eea;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
    }
    .contractor-card.recommended {
      border-color: #28a745;
      background: #f8fff8;
    }
    .contractor-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }
    .contractor-name {
      font-size: 1.3em;
      font-weight: 600;
      color: #333;
    }
    .match-score {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: 600;
    }
    .contractor-rating {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .stars {
      color: #ffc107;
      font-size: 1.2em;
    }
    .review-count {
      color: #666;
      font-size: 0.9em;
    }
    .contractor-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 15px 0;
      color: #666;
      font-size: 0.9em;
    }
    .contractor-meta span {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .quote-box {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    .quote-box label {
      display: block;
      color: #666;
      font-size: 0.85em;
      margin-bottom: 5px;
    }
    .quote-box .price {
      font-size: 1.5em;
      font-weight: bold;
      color: #28a745;
    }
    .why-recommended {
      background: #e8f5e9;
      border-left: 4px solid #28a745;
      padding: 12px 15px;
      border-radius: 0 8px 8px 0;
      margin-top: 15px;
      font-size: 0.95em;
      color: #2e7d32;
    }
    .contact-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 0.95em;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-primary {
      background: #667eea;
      color: white;
    }
    .btn-primary:hover { background: #5a6fd6; }
    .btn-secondary {
      background: #e0e0e0;
      color: #555;
    }
    .btn-secondary:hover { background: #d0d0d0; }
    .btn-success {
      background: #28a745;
      color: white;
    }
    .btn-success:hover { background: #218838; }
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }
    .empty-state h2 {
      color: #666;
      margin-bottom: 20px;
    }
    .tips-section {
      background: #fff3cd;
      border-radius: 12px;
      padding: 25px;
    }
    .tips-section h3 {
      color: #856404;
      margin-bottom: 15px;
    }
    .tips-section ul {
      margin-left: 20px;
      color: #856404;
    }
    .tips-section li {
      margin-bottom: 8px;
    }
    .badge {
      display: inline-block;
      padding: 3px 10px;
      background: #667eea;
      color: white;
      border-radius: 12px;
      font-size: 0.8em;
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <header>
    <h1>üî® Matched Contractors</h1>
  </header>

  <div class="container">
    <a href="/" class="back-link">‚Üê Back to Dashboard</a>

    <% if (!allocation) { %>
      <div class="section empty-state">
        <h2>No contractors allocated yet</h2>
        <p>Generate a budget estimate first to match with contractors.</p>
        <a href="/estimate" class="btn btn-primary">View Estimate</a>
      </div>
    <% } else { %>

      <!-- Summary -->
      <div class="summary-cards">
        <div class="card">
          <h3>Projects</h3>
          <div class="value"><%= allocation.projects.length %></div>
        </div>
        <div class="card">
          <h3>Contractors</h3>
          <div class="value"><%= allocation.summary.totalContractors %></div>
        </div>
        <div class="card">
          <h3>Est. Total</h3>
          <div class="value">$<%= (allocation.summary.totalEstimatedCost/1000).toFixed(0) %>k</div>
        </div>
      </div>

      <!-- Contractor Matches -->
      <% allocation.projects.forEach(project => { %
        <% if (project.recommendedContractors.length > 0) { %>
          <div class="project-section">
            <div class="project-title">
              <h3><%= project.project.name %></h3>
              <div class="budget">
                Budget: $<%= project.project.baseCost.min.toLocaleString() %> - $<%= project.project.baseCost.max.toLocaleString() %>
              </div>
            </div>

            <% project.recommendedContractors.forEach((contractor, index) => { %
              <div class="contractor-card <%= index === 0 ? 'recommended' : '' %>">
                <div class="contractor-header">
                  <div>
                    <div class="contractor-name"><%= contractor.name %></div>
                    <div class="contractor-rating">
                      <span class="stars"><%= '‚òÖ'.repeat(Math.floor(contractor.rating)) %><%= '‚òÜ'.repeat(5 - Math.floor(contractor.rating)) %></span>
                      <span class="review-count"><%= contractor.rating %>/5 (<%= contractor.reviews %> reviews)</span>
                    </div>
                    <div>
                      <% contractor.specialties.forEach(specialty => { %
                        <span class="badge"><%= specialty %></span>
                      <% }); %>
                    </div>
                  </div>
                  <div class="match-score"><%= Math.round(contractor.matchScore) %>% Match</div>
                </div>

                <div class="contractor-meta">
                  <span>üìç <%= contractor.location %></span>
                  <span>üìÖ Available: <%= contractor.availability %></span>
                  <span>‚úì Licensed & Insured</span>
                </div>

                <div class="quote-box">
                  <label>Estimated Quote</label>
                  <div class="price">
                    $<%= contractor.estimatedQuote.min.toLocaleString() %> - $<%= contractor.estimatedQuote.max.toLocaleString() %>
                  </div>
                </div>

                <div class="why-recommended">
                  <strong>Why recommended:</strong> <%= contractor.whyRecommended %>
                </div>

                <div class="contact-buttons">
                  <a href="tel:<%= contractor.contact.phone %>" class="btn btn-primary">
                    üìû Call
                  </a>
                  <a href="mailto:<%= contractor.contact.email %>" class="btn btn-secondary">
                    ‚úâÔ∏è Email
                  </a>
                  <% if (index === 0) { %>
                    <button class="btn btn-success">‚úì Request Quote</button>
                  <% } %>
                </div>
              </div>
            <% }); %>
          </div>
        <% } %
      <% }); %

      <!-- Tips -->
      <div class="tips-section">
        <h3>üí° Tips for Working with Contractors</h3>
        <ul>
          <li>Get at least 3 quotes for each major project</li>
          <li>Check licenses and insurance certificates</li>
          <li>Ask for references from recent similar projects</li>
          <li>Review contracts carefully before signing</li>
          <li>Never pay full amount upfront (10-20% deposit is standard)</li>
          <li>Document everything in writing</li>
          <li>Set clear milestones and payment schedules</li>
        </ul>
      </div>

    <% } %>
  </div>
</body>
</html>
